@{
    ViewData["Title"] = "I tuoi progetti";
}

<h2>@ViewData["Title"]</h2>

<div id="progettiContainer">
    <ul id="progettiList"></ul>
</div>

@section Scripts {
    <script>

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        async function getUserProject() {
            const userId = getCookie('userId');

            if (!userId) {
                console.log("Nessun userId trovato. Reindirizzamento al login.");
                window.location.href = "/Aut/Login";
                return;
            }

            console.log(`Recupero progetti per l'utente con ID: ${userId}`);

            try {
                const response = await fetch(`/api/utente/progetti/${userId}`);

                if (!response.ok) {
                    console.error("Errore nel recupero dei progetti:", response.statusText);
                    return;
                }

                const progetti = await response.json();

                if (!progetti || progetti.length === 0) {
                    console.log("Nessun progetto trovato per l'utente.");
                    return;
                }

                console.log("Progetti ricevuti:", progetti);

               
                const progettiList = document.getElementById('progettiList');
                progettiList.innerHTML = ""; 

                progetti.forEach(progetto => {
                    const listItem = document.createElement("li");
                    listItem.textContent = progetto.nome; 
                    progettiList.appendChild(listItem);
                });

            } catch (error) {
                console.error("Errore nella richiesta API:", error);
            }
        }

       getUserProject();
    </script>
}
